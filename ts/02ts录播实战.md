# ts实战
### ts原理
* ts在编译时提供了类型检测
* ts 拆分了几大模块
```ts
// 源码输入
let str: string = 'xxxx'

// 2 scanner 扫描器 => 生成流
[
  "let": "keyword",
  "str": "indentifier",
  "string": "type",
  "=": 'assignment',
  "xxxx": "integer",
]


// 3、parser 解析器 => AST
{
  operation: "=",
  left: {
    keyword: "let",
    right: "str",
  },
  right: "xxx",
  type: string,
  content: {
    // ...
  }
}

// 4、binder 绑定器 => 映射
// 创建了一个AST节点到符号(node.symbol)的引用连接

// 5、检验器 => 检验类型
// 检验ts的语法错误

// 6、发射器 => js
// 分发转译成可执行js的工作
```

## 1、元数据
* ts带来了动态的类型检测、同时也带来了以类为基础的面向对象
* 元素据(reflect-metadata)：描述数据的数据
<br></br>

#### 基本使用
* 首先需要暗转 reflect-metadata库
> npm install reflect-metadata

```ts
import 'reflect-metadata'

// Reflect.defineMetadata(metadataKey, metadataValue, propertykey)
// metadataKey: meta数据的key
// metadataValue： 当前meta数据的值
// propertykey： 对应属性的key

class Test {
  public static clsMethod() {}

  public insetMethod() {}
}

let obj = new Test()

// 写操作
Reflect.defineMetadata('meta', 'class', Test)
Reflect.defineMetadata('meta', 'class method', Test, 'clsMethod')
Reflect.defineMetadata('meta', 'instance method', obj)

// 读操作
Reflect.getMetadata('meta', Test)
Reflect.getMetadata('meta', Test, 'clsMethod')
Reflect.getMetadata('meta', obj, 'instMethod')

function classDecrorator(): ClassDecorator {
  return target => {
    console.log('classDecorator')
    Reflect.defineMetadata('meta', 'class', target)
  }
}

function staticMethodDecorator(): MethodDecorator {
  return (target, key) => {
    console.log('staticMethodDecorator')
    Reflect.defineMetadata('meta', 'clsMethod', target, key)
  }
}

function methodDecorator(): MethodDecorator {
  return (target, key) => {
    console.log('methodDecorator')
    Reflect.defineMetadata('meta', 'clsMethod', target, key)
  }
}

function methodDecorator2(): MethodDecorator {
  return (target, key) => {
    console.log('xxx')
  }
}

@classDecrorator()
class Test2 {
  @staticMethodDecorator()
  public static clsMethod() {}

  @methodDecorator()
  @methodDecorator2()
  public instMethod() {}
}

let obj2 = new Test()
console.log(Reflect.getMetadata('meta', Test2))
```


#### 实战
* node 路由控制....

* 基于ts实现一个countdown计数器....
未完成